<section id="products" class="py-16 bg-cream">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-12 text-primary">產品系列</h2>
    
    <div class="relative overflow-hidden" id="product-slider-container">
      <div class="flex transition-transform duration-500 ease-in-out" id="product-slider">
        {% for category in categories %}
        {# 修改此處：將 lg:w-1/4 改為 min-[1300px]:w-1/4 #}
        <div class="w-full md:w-1/2 min-[1300px]:w-1/4 flex-shrink-0 px-4">
          <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow h-full">
            <img src="{{ category.image.url }}" alt="{{ category.name }}" class="w-full h-64 object-cover">
            <div class="p-6">
              <h3 class="text-xl font-bold mb-3 text-primary">{{ category.name }}</h3>
              <p class="text-gray-700 mb-4">{{ category.description }}</p>
              <a href="{% url 'product' %}?category={{ category.name }}" class="text-secondary hover:text-primary-light font-medium">查看更多 &rarr;</a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      
      <button class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-50 hover:bg-opacity-70 p-2 rounded-full shadow-md z-20 focus:outline-none" id="product-prev-button">
        <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 24 24">
          <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path>
        </svg>
      </button>
      <button class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-50 hover:bg-opacity-70 p-2 rounded-full shadow-md z-20 focus:outline-none" id="product-next-button">
        <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"></path>
        </svg>
      </button>
    </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const slider = document.getElementById('product-slider');
    const prevButton = document.getElementById('product-prev-button');
    const nextButton = document.getElementById('product-next-button');
    const sliderContainer = document.getElementById('product-slider-container');
    
    let currentIndex = 0;
    const totalProducts = document.querySelectorAll('#product-slider > div').length;
    
    function getItemWidth() {
        if (window.innerWidth >= 1300) {
            return 25;
        } else if (window.innerWidth >= 768) {
            return 50;
        } else {
            return 100;
        }
    }
    
    function getMaxIndex() {
        const itemWidth = getItemWidth();
        const visibleItems = Math.floor(100 / itemWidth);
        return Math.max(0, totalProducts - visibleItems);
    }
    
    function updateSlider() {
        const itemWidth = getItemWidth();
        slider.style.transform = `translateX(-${currentIndex * itemWidth}%)`;
    }
    
    function nextSlide() {
        const maxIndex = getMaxIndex();
        currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
        updateSlider();
    }
    
    function prevSlide() {
        const maxIndex = getMaxIndex();
        currentIndex = currentIndex <= 0 ? maxIndex : currentIndex - 1;
        updateSlider();
    }
    
    nextButton.addEventListener('click', nextSlide);
    prevButton.addEventListener('click', prevSlide);

    window.addEventListener('resize', updateSlider);
    
    updateSlider();
});
</script>