<div class="relative group z-40 inline-block text-left" id="category-dropdown-container">
    
    <div class="flex items-center gap-2">
        <div class="bg-[#d4bcb0] text-[#A97659] px-6 py-2 shadow-md transition-all duration-300 border-4 border-white outline outline-4 outline-[#A67052] relative overflow-hidden min-w-[180px] text-center cursor-default">
            <span class="font-bold tracking-widest text-2xl">
                {% if request.GET.category %}
                    {% for category in categories %}
                        {% if request.GET.category|stringformat:"s" == category.id|stringformat:"s" %}
                            {{ category.name }}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    所有產品
                {% endif %}
            </span>
        </div>

        <button id="category-toggle-btn" class="w-10 h-10 rounded-full bg-[#d4bcb0] hover:bg-[#A67052] text-white flex items-center justify-center shadow-md transition-all duration-300 transform hover:scale-110 focus:outline-none">
            <svg id="category-arrow" class="w-6 h-6 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>
    </div>

    <div id="category-dropdown-menu" class="absolute top-full left-0 w-[180px] mt-4 hidden z-50 transform origin-top transition-all duration-300">
        <div class="bg-[#A67052] shadow-xl border-4 border-[#d4bcb0] overflow-hidden">
            <div class="py-0">
                <a href="{% url 'product' %}" 
                   class=" text-2xl block px-4 py-3 font-bold tracking-wide transition-colors text-center 
                          bg-[#d4bcb0] text-[#A97659]
                          border-b border-[#A97659]/30
                          hover:bg-white">
                    所有產品
                </a>
                
                {% for category in categories %}
                <a href="?category={{ category.id }}" 
                   class=" text-2xl block px-4 py-3 font-bold tracking-wide transition-colors text-center 
                          bg-[#d4bcb0] text-[#A97659]
                          border-b border-[#A97659]/30 last:border-0
                          hover:bg-white">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        const toggleBtn = document.getElementById('category-toggle-btn');
        const dropdownMenu = document.getElementById('category-dropdown-menu');
        const arrow = document.getElementById('category-arrow');
        const container = document.getElementById('category-dropdown-container');

        if (toggleBtn) {
            toggleBtn.addEventListener('click', function(e) {
                e.stopPropagation(); 
                dropdownMenu.classList.toggle('hidden');
                
                if (dropdownMenu.classList.contains('hidden')) {
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    arrow.style.transform = 'rotate(180deg)';
                }
            });

            document.addEventListener('click', function(e) {
                if (container && !container.contains(e.target)) {
                    dropdownMenu.classList.add('hidden');
                    arrow.style.transform = 'rotate(0deg)';
                }
            });
        }
    })();
</script>
